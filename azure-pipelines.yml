# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  - dev

pool:
  name: Self-hosted

steps:
  # Checkout dev branch with credentials
  - checkout: self
    persistCredentials: true

  # Pull latest changes from remote dev to avoid conflicts
  - task: Bash@3
    displayName: Pull latest dev changes
    inputs:
      targetType: inline
      script: |
        set -euo pipefail

        echo "Fetching all branches"
        git fetch origin

        echo "Checkout dev branch"
        git checkout dev

        echo "Pull latest changes from remote dev"
        git pull origin dev --rebase

  # Create PR from dev -> master
  - task: Bash@3
    displayName: Create Pull Request dev -> master
    inputs:
      targetType: inline
      script: |
        echo "Creating Pull Request from dev to master"
        az repos pr create --repository YOUR_REPO_NAME \
                           --source-branch dev \
                           --target-branch master \
                           --title "Auto PR: dev â†’ master" \
                           --description "Automated PR generated by pipeline"
