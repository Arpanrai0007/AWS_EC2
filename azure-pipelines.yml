# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  - dev   

pool:
  name: Self-hosted  

steps:
  # Checkout with credentials so push works
  - checkout: self
    persistCredentials: true

  # Merge dev into master (auto-resolve conflicts)
  - task: Bash@3
    displayName: Merge dev into master (auto-resolve conflicts)
    inputs:
      targetType: inline
      script: |
        set -euo pipefail

        echo "Fetching latest branches"
        git fetch origin

        echo "Checkout master"
        git checkout master
        git pull origin master

        echo "Merge dev into master (auto-resolve conflicts by taking dev)"
        git merge origin/dev -X theirs --no-ff --allow-unrelated-histories

        echo "Push to master"
        git push origin master
